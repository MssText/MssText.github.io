---
title: é€šç”¨ç»„ä»¶å®ç°
date: 2021-05-24 21:56:01
permalink: /pages/a40f7d/
categories:
  - å‰ç«¯ä¹±ç‚–
  - vue
  - vueç»„ä»¶åº“å¼€å‘å®è·µ
tags:
  - 
---
### å‰è¨€

ä¸»è¦ä»‹ç»ä¸‹`Alert`ã€`Avatar`ã€ `Backtop`ã€`Badge`ã€`Divider`ã€`Card`ã€`Message`çš„å®ç°åŸç†ï¼Œä¸ä¼šé€è¡Œè§£é‡Šï¼Œæ¯•ç«Ÿç›¸åŒçš„ç»„ä»¶ä¸åŒçš„äººçš„å®ç°æ€è·¯æ˜¯ä¸ä¸€æ ·çš„ã€‚

### Alert

å…ˆå›é¡¾ä¸‹ï¼Œ`Alert` ç»„ä»¶çš„ä½¿ç”¨æ–¹å¼ã€‚

::: demo

```vue
<template>
  <div class="wapper">
    <ml-alert showIcon title="è¿™æ˜¯ä¸€æ¡æç¤ºä¿¡æ¯"></ml-alert>
  </div>
</template>
<script>
export default {
  data () {}
}
</script>
<style>

</style>
```
:::

ä¹‹å‰çš„æ–‡ç« å·²ç»æåˆ°äº†æ¯ä¸ªç»„ä»¶çš„ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ï¼š

```js
â”œâ”€â”€ index.js
â””â”€â”€ main.vue
```

 `index.js`æ–‡ä»¶æˆ‘ä»¬å°±ä¸åŠ èµ˜è¿°äº†ï¼Œä¸»è¦è¯´ä¸€ä¸‹ `main.vue`çš„å®šä¹‰ï¼š

```vue
<template>
  <div class="ml-alert" :class="[typeClass]" v-show="visible">
    <i class="ml-alert__icon" :class="[iconClass]" v-if="showIcon"></i>
    <div class="ml-alert__content">
      <span class="ml-alert__title" v-if="title || $slots.title">
        <slot name="title">{{ title }}</slot>
      </span>
      <i
        class="ml-alert__closebtn"
        :class="{
          'ml-icon-close': closeText === '',
        }"
        v-show="closable"
        @click="close()"
        >{{ closeText }}</i
      >
    </div>
  </div>
</template>

<script>
const TYPE_CLASSES_MAP = {
  success: "ml-icon-success",
  warning: "ml-icon-warning",
  error: "ml-icon-error",
};
export default {
  name: "MlAlert",

  props: {
    title: { // è‡ªå®šä¹‰å±•ç¤ºçš„æ–‡æ¡ˆ
      type: String,
      default: "",
    },
    type: {
      type: String, // successã€warningã€error
      default: "info",
    },
    closable: { // æ˜¯å¦å±•ç¤ºå…³é—­æŒ‰é’®
      type: Boolean,
      default: true,
    },
    closeText: { // å…³é—­æŒ‰é’®çš„æç¤ºæ–‡å­—
      type: String,
      default: "",
    },
    showIcon: Boolean, // æ˜¯å¦å±•ç¤ºicon
    center: Boolean, // æ˜¯å¦å±…ä¸­å±•ç¤º
  },

  data() {
    return {
      visible: true,
    };
  },

  methods: {

    // å…³é—­Cardå®ä¾‹
    close() {
      this.visible = false;
      this.$emit("close");
    },
  },

  computed: {

    // æ ¹æ® type åŠ¨æ€è®¡ç®—ç±»å
    typeClass() {
      return `ml-alert--${this.type}`;
    },

    // æ ¹æ® type åŠ¨æ€è®¡ç®— icon ç±»å
    iconClass() {
      return TYPE_CLASSES_MAP[this.type] || "ml-icon-info";
    },
  },
};
</script>

```

ç»“æ„å¾ˆç®€å•ï¼Œå¦‚ä¸‹å›¾ï¼š

::: center
<img src="https://cdn.jsdelivr.net/gh/MssText/learn@master/images/image-20210531095726439.6eqjd15m4tc0.png">
:::

ç»“æ„ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š
- çº¢è‰²æ¡†æ˜¯æœ€å¤–å±‚çš„çˆ¶å®¹å™¨ï¼Œä¸»è¦æ˜¯æ§åˆ¶ `Alert` ç»„ä»¶çš„æ˜¾ç¤ºå’Œéšè—
- è“è‰²æ¡†æ˜¯ icon æ”¾ç½®åŒºåŸŸ
- é»„è‰²æ¡†æ˜¯ è‡ªå®šä¹‰å†…å®¹åŒºåŸŸ

å†çœ‹çœ‹æ ·å¼ï¼Œæ ·å¼æ–‡ä»¶åœ¨ `src/theme/alert.scss` ç›®å½•ä¸‹ï¼š

```scss

@import "mixins/mixins";
@import "common/var";

@include b(alert) {
  width: 100%;
  padding: $--alert-padding;
  margin: 0;
  box-sizing: border-box;
  border-radius: $--alert-border-radius;
  position: relative;
  color: $--color-success;
  background-color: $--alert-success-color;
  overflow: hidden;
  opacity: 1;
  display: flex;
  align-items: center;
  transition: opacity .2s;

  & [class*="ml-icon-"] {
    & + div {
      margin-left: 5px;
    }
  }

  @include m(success) {
    &.is-light {
      background-color: $--alert-success-color;
      color: $--color-success;

      .ml-alert__description {
        color: $--color-success;
      }
    }
  }

  @include m(info) {
    &.is-light {
      background-color: $--alert-info-color;
      color: $--color-info;
    }

    &.is-dark {
      background-color: $--color-info;
      color: $--color-white;
    }

    .el-alert__description {
      color: $--color-info;
    }
  }

  @include m(warning) {
    &.is-light {
      background-color: $--alert-warning-color;
      color: $--color-warning;

      .el-alert__description {
        color: $--color-warning;
      }
    }

    &.is-dark {
      background-color: $--color-warning;
      color: $--color-white;
    }
  }

  @include m(error) {
    &.is-light {
      background-color: $--alert-danger-color;
      color: $--color-danger;

      .el-alert__description {
        color: $--color-danger;
      }
    }

    &.is-dark {
      background-color: $--color-danger;
      color: $--color-white;
    }
  }

  @include e(icon) {
    font-size: $--alert-icon-size;
    width: $--alert-icon-size;
  }

  @include e(title) {
    font-size: $--alert-title-font-size;
    line-height: 18px;
    @include when(bold) {
      font-weight: bold;
    }
  }

  @include e(closebtn) {
    font-size: $--alert-close-font-size;
    opacity: 1;
    position: absolute;
    top: 12px;
    right: 15px;
    cursor: pointer;
  }
}
```
æ ·å¼éœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯ `box-sizing: border-box;` è¿™å¥ä»£ç ã€‚åœ¨cssé»˜è®¤çš„[ç›’æ¨¡å‹](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Box_Model/Introduction_to_the_CSS_box_model)ä¸­ï¼Œä½ å¯¹ä¸€ä¸ªå…ƒç´ æ‰€è®¾ç½®çš„ `width` ä¸ `height` åªä¼šåº”ç”¨åˆ°è¿™ä¸ªå…ƒç´ çš„å†…å®¹åŒºã€‚å¦‚æœè¿™ä¸ªå…ƒç´ æœ‰ä»»ä½•çš„ `border` æˆ– `padding` ï¼Œç»˜åˆ¶åˆ°å±å¹•ä¸Šæ—¶çš„ç›’å­å®½åº¦å’Œé«˜åº¦ä¼šåŠ ä¸Šè®¾ç½®çš„è¾¹æ¡†å’Œå†…è¾¹è·å€¼ã€‚è¿™æ„å‘³ç€å½“ä½ è°ƒæ•´ä¸€ä¸ªå…ƒç´ çš„å®½åº¦å’Œé«˜åº¦æ—¶éœ€è¦æ—¶åˆ»æ³¨æ„åˆ°è¿™ä¸ªå…ƒç´ çš„è¾¹æ¡†å’Œå†…è¾¹è·ã€‚å½“æˆ‘ä»¬å®ç°å“åº”å¼å¸ƒå±€æ—¶ï¼Œè¿™ä¸ªç‰¹ç‚¹å°¤å…¶çƒ¦äººã€‚æ‰€ä»¥è¿™é‡Œï¼Œå°† `box-sizing` è®¾ç½®ä¸º `border-box`,ä¹Ÿå°±æ˜¯æ˜ç¡®å‘Šè¯‰æµè§ˆå™¨ï¼š
> ä½ æƒ³è¦è®¾ç½®çš„è¾¹æ¡†å’Œå†…è¾¹è·çš„å€¼æ˜¯åŒ…å«åœ¨widthå†…çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ å°†ä¸€ä¸ªå…ƒç´ çš„widthè®¾ä¸º100pxï¼Œé‚£ä¹ˆè¿™100pxä¼šåŒ…å«å®ƒçš„borderå’Œpaddingï¼Œå†…å®¹åŒºçš„å®é™…å®½åº¦æ˜¯widthå‡å»(border + padding)çš„å€¼ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬æ›´å®¹æ˜“åœ°è®¾å®šä¸€ä¸ªå…ƒç´ çš„å®½é«˜ã€‚

::: warning
border-boxä¸åŒ…å«margin
::: 

### Avatar

`Avatar` ç»„ä»¶ç”¨äºå¤´åƒã€å›¾æ ‡çš„å±•ç¤ºã€‚

::: demo

```vue
<template>
  <ml-avatar
    shape="square"
    :size="100"
    src="https://fuss10.elemecdn.com/e/5d/4a731a90594a4af544c0c25941171jpeg.jpeg"></ml-avatar>
</template>
<script>
export default {
  data () {}
}
</script>
<style>

</style>

```
:::

æˆ‘ä»¬çœ‹ä¸‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Œ`main.vue`çš„å®šä¹‰ï¼š

```vue
<template>
  <span :class="[avatarClass]" :style="[sizeStyle]">
    <img
      v-if="isImageExist && src"
      :src="src"
      :onError="handleError"
      :alt="alt"
      :style="[{ 'object-fit': fit }]"
    />
    <i v-if="icon && !isImageExist && !src" :class="icon" />
    <slot v-else />
  </span>
</template>

<script>
export default {
  name: "MlAvatar",
  props: {
    shape: {
      // è®¾ç½®å›¾åƒçš„å½¢çŠ¶
      type: String,
      default: "circle",
      validator(val) {
        return ["circle", "square"].includes(val);
      },
    },
    size: [Number, String], // å¤´åƒçš„å¤§å°
    icon: String, // è®¾ç½®å›¾æ ‡çš„å¤´åƒç±»å‹
    src: String, // å›¾ç‰‡å¤´åƒçš„èµ„æºåœ°å€
    alt: String, // æè¿°å›¾åƒçš„æ›¿æ¢æ–‡æœ¬
    error: Function, // å›¾åƒåŠ è½½å¤±è´¥å›è°ƒ
    fit: {
      // åŒåŸç”Ÿçš„fitå±æ€§
      type: String,
      default: "cover",
    },
  },
  data() {
    return {
      isImageExist: true, // å›¾åƒæ˜¯å¦å­˜åœ¨
    };
  },
  methods: {

    // å›¾ç‰‡åŠ è½½é”™è¯¯å¤„ç†å‡½æ•°
    handleError() {
      const { error } = this;
      const errorFlag = error ? error() : undefined;
      if (errorFlag !== false) {
        this.isImageExist = false;
      }
    },
  },
  computed: {

    // æ ¹æ®iconã€shape è®¡ç®—æ ·å¼å
    avatarClass() {
      const { icon, shape } = this;
      let classList = ["ml-avatar"];

      if (icon) {
        classList.push("ml-avatar--icon");
      }

      if (shape) {
        classList.push(`ml-avatar--${shape}`);
      }

      return classList;
    },

    // å¤´åƒ æˆ–è€… å›¾æ ‡ çš„å°ºå¯¸
    sizeStyle() {
      const { size } = this;
      return typeof size === "number"
        ? {
            height: `${size || 60}px`,
            width: `${size || 60}px`,
            lineHeight: `${size || 60}px`,
          }
        : {};
    },
  },
};
</script>

```

ä¸»è¦å°±æ˜¯å±•ç¤ºå›¾ç‰‡æˆ–è€…å›¾æ ‡ï¼Œç„¶åç”¨äº†ä¸€ä¸ªé»˜è®¤æ’æ§½ï¼Œæ–¹ä¾¿ç”¨æˆ·è‡ªå®šä¹‰å…¶ä»–å±•ç¤ºçš„å†…å®¹ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ `isImageExist` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯æ—¶è§¦å‘ç”¨æˆ·å®šä¹‰çš„å¤„ç†å‡½æ•°ã€‚

å†çœ‹ä¸‹æ ·å¼æ–‡ä»¶ï¼š

```scss

@import "mixins/mixins";
@import "common/var";

@include b(avatar) {
  display: inline-block;
  box-sizing: border-box;
  text-align: center;
  overflow: hidden;
  color: $--avatar-font-color;
  width: $--avatar-large-size;
  height: $--avatar-large-size;
  background: $--avatar-background-color;
  line-height: $--avatar-large-size;
  font-size: $--avatar-text-font-size;

  > img {
    display: block;
    height: 100%;
    vertical-align: middle;
  }

  @include m(circle) {
    border-radius: 50%;
  }

  @include m(square) {
    border-radius: $--avatar-border-radius;
  }

  @include m(icon) {
    font-size: $--avatar-icon-font-size;
  }
}

```
### Badge

`Badge` ç»„ä»¶ç”¨äºå±•ç¤ºæ¶ˆæ¯æ•°é‡æˆ–è€…æŒ‰é’®çš„çŠ¶æ€ï¼Œçœ‹çœ‹åŸºæœ¬ä½¿ç”¨ï¼š

::: demo
```vue
<template>
  <div>
    <ml-badge value="hot">è¯„è®º</ml-badge>
    <ml-badge value="new" style="margin-left: 30px">å›å¤</ml-badge>
  </div>
</template>
<script>
export default {
  data () {}
}
</script>
<style>

</style>

```
:::

`main.vue` ä¸­çš„å®šä¹‰ï¼š

```vue
<template>
  <div class="ml-badge">
    <slot></slot>
    <transition name="ml-zoom-in-center">
      <sup
        v-show="!hidden && (content || content === 0 || isDot)"
        v-text="content"
        class="ml-badge__content"
        :class="[
          'ml-badge__content--' + type,
          {
            'is-fixed': $slots.default,
            'is-dot': isDot,
          },
        ]"
      >
      </sup>
    </transition>
  </div>
</template>

<script>
export default {
  name: "MlBadge",

  props: {
    value: [String, Number], // å³ä¸Šè§’å±•ç¤ºçš„å€¼
    max: Number, // å±•ç¤ºçš„æœ€å¤§å€¼
    isDot: Boolean, // å±•ç¤ºå°åœ†ç‚¹
    hidden: Boolean, // æ˜¯å¦éšè—
    type: { // å±•ç¤ºçš„çŠ¶æ€
      type: String,
      validator(val) {
        return (
          ["primary", "success", "warning", "info", "danger"].indexOf(val) > -1
        );
      },
    },
  },

  computed: {

    // badgeå±•ç¤ºçš„å†…å®¹
    // å¦‚æœä¼ å…¥äº†æœ€å¤§å€¼ï¼Œè¶…è¿‡æœ€å¤§å€¼å°±é»˜è®¤å±•ç¤ºæœ€å¤§å€¼
    content() {
      if (this.isDot) return;

      const value = this.value;
      const max = this.max;

      if (typeof value === "number" && typeof max === "number") {
        return max < value ? `${max}+` : value;
      }

      return value;
    },
  },
};
</script>

```

çœ‹çœ‹æ ·å¼æ–‡ä»¶ï¼š

```scss

@import "mixins/mixins";
@import "common/var";

@include b(badge) {
  position: relative;
  vertical-align: middle;
  display: inline-block;

  @include e(content) {
    background-color: $--badge-background-color;
    border-radius: $--badge-radius;
    color: $--color-white;
    display: inline-block;
    font-size: $--badge-font-size;
    height: $--badge-size;
    line-height: $--badge-size;
    padding: 0 $--badge-padding;
    text-align: center;
    white-space: nowrap;
    border: 1px solid $--color-white;

    @include when(fixed) {
      position: absolute;
      top: 0;
      right: #{1 + $--badge-size / 2};
      transform: translateY(-50%) translateX(100%);

      @include when(dot) {
        right: 5px;
      }
    }

    @include when(dot) {
      height: 8px;
      width: 8px;
      padding: 0;
      right: 0;
      border-radius: 50%;
    }

    @each $type in (primary, success, warning, info, danger) {
      @include m($type) {
        @if $type == primary {
          background-color: $--color-primary;
        } @else if $type == success {
          background-color: $--color-success;
        } @else if $type == warning {
          background-color: $--color-warning;
        } @else if $type == info {
          background-color: $--color-info;
        } @else {
          background-color: $--color-danger;
        }
      }
    }
  }
}
```
### Backtop

`Backtop` ç»„ä»¶æ˜¯ç”¨äºå›åˆ°é¡¶éƒ¨ï¼Œçœ‹çœ‹åŸºæœ¬ä½¿ç”¨ï¼š

```vue
<template>
  <ml-backtop></ml-backtop>
</template>
<script>
export default {
  data () {}
}
</script>
<style>

</style>

```

`main.vue` çš„å®šä¹‰ï¼š

```vue
<template>
  <ml-badge></ml-badge>
</template>

<script>
// ä½¿ç”¨throttleé˜²æŠ–
import { throttle } from "throttle-debounce";

// ä½¿ç”¨è´å¡å°”æ›²çº¿ ä½¿å¾—åŠ¨ç”»æ›´åŠ å¹³æ»‘
const cubic = (value) => Math.pow(value, 3);
const easeInOutCubic = (value) =>
  value < 0.5 ? cubic(value * 2) / 2 : 1 - cubic((1 - value) * 2) / 2;

export default {
  name: "MlBacktop",

  props: {
    visibilityHeight: {
      type: Number, // è¿”å›æŒ‰é’®å‡ºç°çš„é«˜åº¦
      default: 200,
    },
    target: [String], // è§¦å‘æ»šåŠ¨çš„å¯¹è±¡
    right: {
      type: Number,
      default: 40, // å³è¾¹è·
    },
    bottom: {
      type: Number,
      default: 40, // åº•è¾¹è·
    },
  },

  data() {
    return {
      el: null,
      container: null,
      visible: false,
    };
  },

  computed: {
    styleBottom() {
      return `${this.bottom}px`;
    },
    styleRight() {
      return `${this.right}px`;
    },
  },

  mounted() {

    // åˆå§‹åŒ– è·å–ç›‘å¬çš„ç›®æ ‡å…ƒç´ 
    this.init();

    // é˜²æŠ– é¿å…å¤šæ¬¡ç‚¹å‡»
    this.throttledScrollHandler = throttle(300, this.onScroll);

    // ç›‘å¬æ»šåŠ¨äº‹ä»¶
    this.container.addEventListener("scroll", this.throttledScrollHandler);
  },

  methods: {
    init() {
      this.container = document;
      this.el = document.documentElement;
      if (this.target) {
        this.el = document.querySelector(this.target);
        if (!this.el) {
          throw new Error(`target is not existed: ${this.target}`);
        }
        this.container = this.el;
      }
    },

    // æ ¹æ®æ»šåŠ¨é«˜åº¦ åˆ¤æ–­backtopæŒ‰é’®æ˜¯å¦æ˜¾ç¤º
    onScroll() {
      const scrollTop = this.el.scrollTop;
      this.visible = scrollTop >= this.visibilityHeight;
    },

    // ç‚¹å‡»å›åˆ°é¡¶éƒ¨
    handleClick(e) {
      this.scrollToTop();
      this.$emit("click", e);
    },

    // å›åˆ°é¡¶éƒ¨çš„é€»è¾‘
    // å®é™…ä¸Šå°±æ˜¯å°† å…ƒç´ çš„ scrollTop è®¾ç½®ä¸º 0
    scrollToTop() {
      const el = this.el;
      const beginTime = Date.now();
      const beginValue = el.scrollTop;
      const rAF =
        window.requestAnimationFrame || ((func) => setTimeout(func, 16));
      // requestAnimationFrame è¿™é‡Œç”¨æ¥æ‰§è¡ŒåŠ¨ç”» æ›´åŠ æµç•…
      const frameFunc = () => {
        // åŠ¨ç”»æ‰§è¡Œæ—¶é—´ä¸º500ms
        const progress = (Date.now() - beginTime) / 500;
        if (progress < 1) {
          el.scrollTop = beginValue * (1 - easeInOutCubic(progress));
          rAF(frameFunc);
        } else {
          el.scrollTop = 0;
        }
      };
      rAF(frameFunc);
    },
  },

  // é¡µé¢é”€æ¯æ—¶ ç§»é™¤æ»šåŠ¨äº‹ä»¶çš„ç›‘å¬
  beforeDestroy() {
    this.container.removeEventListener("scroll", this.throttledScrollHandler);
  },
};
</script>

```

æ€è·¯å°±æ˜¯ï¼Œç›‘å¬ç›®æ ‡å…ƒç´ çš„æ»šåŠ¨é«˜åº¦ï¼Œå½“è¶…è¿‡é™å®šçš„é«˜åº¦æ—¶ï¼Œå±•ç¤ºå›åˆ°é¡¶éƒ¨åŠŸèƒ½ï¼Œç‚¹å‡»å›åˆ°é¡¶éƒ¨æŒ‰é’®ï¼Œå°†ç›®æ ‡å…ƒç´ çš„ scrollTop è®¾ç½®ä¸º 0ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼ŒåŠ äº†åŠ¨ç”»çš„æ•ˆæœã€‚ä¸»è¦ç”¨åˆ°çš„æ˜¯ [requestAnimationFrame](https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestAnimationFrame)
å…³äº `requestAnimationFrame`:
> å‘Šè¯‰æµè§ˆå™¨â€”â€”ä½ å¸Œæœ›æ‰§è¡Œä¸€ä¸ªåŠ¨ç”»ï¼Œå¹¶ä¸”è¦æ±‚æµè§ˆå™¨åœ¨ä¸‹æ¬¡é‡ç»˜ä¹‹å‰è°ƒç”¨æŒ‡å®šçš„å›è°ƒå‡½æ•°æ›´æ–°åŠ¨ç”»ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å›è°ƒå‡½æ•°ä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œ

æµè§ˆå™¨æ‰§è¡ŒåŠ¨ç”»ï¼Œé€šå¸¸æ˜¯æ¯ç§’60æ¬¡ï¼Œä½†æ˜¯ä½¿ç”¨ `setInterval`å’Œ`setTimeOut`æ— æ³•ä¿è¯å’Œæµè§ˆå™¨æ‰§è¡Œçš„é¢‘ç‡ä¸€è‡´ï¼ŒsetIntervalåˆ¶ä½œåŠ¨ç”»çš„æ—¶å€™ä¼šå‡ºç°ä¸¢å¸§å’ŒåŠ¨ç”»æ•ˆæœç”Ÿç¡¬ä¸è¿è´¯ç­‰æƒ…å†µã€‚`requestAnimationFrame` æ˜¯HTML5æ–°å‡ºçš„ç‰¹æ€§ï¼Œå°±æ˜¯ä¸ºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### Divider

`Divider` ç»„ä»¶ç”¨äºå±•ç¤ºä¸‹åˆ’çº¿å’Œä¸­åˆ’çº¿ã€‚

::: demo

```vue
<template>
  <div>
    <span>è¥¿ç“œğŸ‰</span>
    <ml-divider direction="vertical"></ml-divider>
    <span>æ©™å­ğŸŠ</span>
    <ml-divider direction="vertical"></ml-divider>
    <span>æ¡ƒğŸ‘</span>
  </div>
</template>
<script>
export default {
  data () {}
}
</script>
<style>

</style>

```
:::

çœ‹ä¸‹ `main.vue`ä¸­çš„å®šä¹‰ï¼š

```vue
<template functional>
  <div :class="['ml-divider', `ml-divider--${props.direction}`]">
    <div
      v-if="slots().default && props.direction !== 'vertical'"
      :class="['ml-divider__text', `is-${props.contentPosition}`]"
    >
      <slot />
    </div>
  </div>
</template>

<script>
// è¿™æ˜¯å‡½æ•°å¼ç»„ä»¶
export default {
  name: "MlDivider",
  props: {
    direction: { // çº¿çš„æ–¹å‘ æ°´å¹³ or å‚ç›´
      type: String,
      default: "horizontal",
      validator(val) {
        return ["horizontal", "vertical"].indexOf(val) !== -1;
      },
    },
    contentPosition: { // çº¿çš„ä½ç½® å·¦ ä¸­ å³
      type: String,
      default: "center",
      validator(val) {
        return ["left", "center", "right"].indexOf(val) !== -1;
      },
    },
  },
};
</script>

```

`divider` æ˜¯ä¸€ä¸ª[å‡½æ•°å¼ç»„ä»¶](https://cn.vuejs.org/v2/guide/render-function.html#%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BB%84%E4%BB%B6)ï¼Œ`å‡½æ•°å¼ç»„ä»¶`çš„ç‰¹ç‚¹å¼ä¸ç®¡ç†ä»»ä½•çŠ¶æ€ï¼Œä¹Ÿä¸ç›‘å¬ä»»ä½•çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå°±æ˜¯ä½œä¸ºæ•°æ®æ¸²æŸ“çš„çº¯å±•ç¤ºç»„ä»¶ã€‚å¯¹äº `divider` æ¥è¯´ï¼Œä¹Ÿç¡®å®åªæœ‰å±•ç¤ºçš„åŠŸèƒ½ï¼Œä¸éœ€è¦ç®¡ç†ä»€ä¹ˆçŠ¶æ€ã€‚

å†çœ‹ä¸‹æ ·å¼ï¼š

```scss
@import "common/var";
@import "mixins/mixins";

@include b(divider) {
  background-color: $--border-color-base;
  position: relative;

  @include m(horizontal) {
    display: block;
    height: 1px;
    width: 100%;
    margin: 24px 0;
  }

  @include m(vertical) {
    display: inline-block;
    width: 1px;
    height: 1em;
    margin: 0 8px;
    vertical-align: middle;
    position: relative;
  }

  @include e(text) {
    position: absolute;
    background-color: $--color-white;
    padding: 0 20px;
    font-weight: 500;
    color: $--color-text-primary;
    font-size: 14px;

    @include when(left) {
      left: 20px;
      transform: translateY(-50%);
    }

    @include when(center)  {
      left: 50%;
      transform: translateX(-50%) translateY(-50%);
    }

    @include when(right)  {
      right: 20px;
      transform: translateY(-50%);
    }
  }
}

```

### Card

`Card` ç»„ä»¶ç”¨äºä½¿ç”¨å¡ç‰‡å±•ç¤ºä¿¡æ¯ã€‚

å…ˆçœ‹çœ‹åŸºæœ¬ä½¿ç”¨ã€‚

::: demo

```vue
<template>
  <div>
    <ml-card>
      <div v-for="o in 4" :key="o" style="padding-bottom: 15px">
        {{ "åˆ—è¡¨å†…å®¹ " + o }}
      </div>
    </ml-card>
  </div>
</template>
<script>
export default {
  data () {}
}
</script>
<style>

</style>

```
:::

çœ‹ä¸‹ `main.vue`çš„å®šä¹‰ï¼š

```vue
<template>
  <div
    class="ml-card"
    :class="shadow ? 'is-' + shadow + '-shadow' : 'is-always-shadow'">
    <div class="ml-card__header" v-if="$slots.header || header">
      <slot name="header">{{ header }}</slot>
    </div>
    <div class="ml-card__body" :style="bodyStyle">
      <slot></slot>
    </div>
  </div>
</template>

<script>
export default {
  name: "MlCard",
  props: {
    header: {},
    bodyStyle: {},
    shadow: {
      type: String,
    },
  },
};
</script>

```
ç»“æ„æ²¡æœ‰ä»€ä¹ˆå¯è¯´çš„ï¼Œçœ‹çœ‹æ ·å¼æ–‡ä»¶ã€‚

```scss
@import "mixins/mixins";
@import "common/var";

@include b(card) {
  border-radius: $--card-border-radius;
  border: 1px solid $--card-border-color;
  background-color: $--color-white;
  overflow: hidden;
  color: $--color-text-primary;
  transition: 0.3s;

  @include when(always-shadow) {
    box-shadow: $--box-shadow-light;
  }

  @include when(hover-shadow) {
    &:hover,
    &:focus {
      box-shadow: $--box-shadow-light;
    }
  }

  @include e(header) {
    padding: #{$--card-padding - 2 $--card-padding};
    border-bottom: 1px solid $--card-border-color;
    box-sizing: border-box;
  }

  @include e(body) {
    padding: $--card-padding;
  }
}

```

### Message

`Message` ç»„ä»¶ç”¨äºåé¦ˆç»™ç”¨æˆ·æŸäº›ä¿¡æ¯ã€‚çœ‹çœ‹åŸºæœ¬ä½¿ç”¨ï¼š

::: demo

```vue
<template>
  <div>
     <ml-button @click="showMessage" type="primary">æ‰“å¼€Message</ml-button>
  </div>
</template>
<script>
export default {
  data () {},
  methods: {
    showMessage() {
    this.$message({
      type: "success",
      showClose: true,
      message: "è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯æç¤º",
    });
  }
  }
}
</script>
<style>

</style>

```
:::

`Message` ç»„ä»¶çš„å°è£…å¾ˆæœ‰æ„æ€ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ã€‚`main.vue` ä¸­çš„å®šä¹‰ï¼š

```vue
<template>
  <transition name="ml-message-fade" @after-leave="handleAfterLeave">
    <div
      :class="[
        'ml-message',
        type && !iconClass ? `ml-message--${type}` : '',
        center ? 'is-center' : '',
        showClose ? 'is-closable' : '',
        customClass,
      ]"
      :style="positionStyle"
      v-show="visible"
      @mouseenter="clearTimer"
      @mouseleave="startTimer"
    >
      <i :class="iconClass" v-if="iconClass"></i>
      <i :class="typeClass" v-else></i>
      <slot>
        <p class="ml-message__content">
          {{ message }}
        </p>
      </slot>
      <i
        v-if="showClose"
        class="ml-message__closeBtn ml-icon-close"
        @click="close"
      ></i>
    </div>
  </transition>
</template>

<script>
const typeMap = {
  success: "success",
  info: "info",
  warning: "warning",
  error: "error",
};

export default {
  name: "MlMessage",
  data() {
    return {
      visible: false, // æ˜¯å¦æ˜¾ç¤º
      message: "", // æç¤ºçš„æ–‡å­—
      duration: 3000, // åŠ¨ç”»çš„æ—¶é—´
      type: "info",
      iconClass: "",
      customClass: "", // è‡ªå®šä¹‰çš„ç±»å
      onClose: null, // å…³é—­çš„å›è°ƒå‡½æ•°
      showClose: false,
      closed: false, // æ˜¯å¦å…³é—­
      verticalOffset: 20, // è·ç¦»é¡¶éƒ¨çš„è·ç¦»
      timer: null, // è®¡æ—¶å™¨
      dangerouslyUseHTMLString: false, // æ˜¯å¦ä½œä¸ºHTMLç‰‡æ®µå±•ç¤º
      center: false, // æ˜¯å¦å±…ä¸­æ˜¾ç¤º
    };
  },

  computed: {

    // æ ¹æ®ä¼ å…¥çš„ type è®¡ç®—è§¦å‘çš„messageçš„ç±»å‹
    typeClass() {
      return this.type && !this.iconClass
        ? `ml-message__icon ml-icon-${typeMap[this.type]}`
        : "";
    },

    // æ¯ä¸ªMessageä¹‹é—´çš„é—´éš”
    positionStyle() {
      return {
        top: `${this.verticalOffset}px`,
      };
    },
  },

  watch: {
    // ç›‘å¬closedå±æ€§ ä¸€æ—¦å˜åŒ– éšè—Message
    closed(newVal) {
      if (newVal) {
        this.visible = false;
      }
    },
  },

  methods: {

    // åŠ¨ç”»ç»“æŸåé”€æ¯å½“å‰å®ä¾‹
    handleAfterLeave() {
      this.$destroy(true);
      this.$el.parentNode.removeChild(this.$el);
    },

    // å…³é—­message
    close() {
      this.closed = true;
      if (typeof this.onClose === "function") {
        this.onClose(this);
      }
    },

    // æ¸…é™¤è‡ªåŠ¨å…³é—­messageçš„å®šæ—¶å™¨
    clearTimer() {
      clearTimeout(this.timer);
    },

    // è®¡æ—¶å™¨ å›ºå®šçš„æ—¶é—´å…³é—­message
    startTimer() {
      if (this.duration > 0) {
        this.timer = setTimeout(() => {
          if (!this.closed) {
            this.close();
          }
        }, this.duration);
      }
    },

    // ä½¿ç”¨ESCé”®å¯ä»¥å…³é—­message
    keydown(e) {
      if (e.keyCode === 27) {
        // escå…³é—­æ¶ˆæ¯
        if (!this.closed) {
          this.close();
        }
      }
    },
  },
  mounted() {
    this.startTimer();
    document.addEventListener("keydown", this.keydown);
  },
  beforeDestroy() {
    document.removeEventListener("keydown", this.keydown);
  },
};
</script>

```

ä¸»è¦é€»è¾‘è¿˜æ˜¯åœ¨ `index.js` ä¸­ï¼š

```js
// @ ä»£è¡¨mssuiæºç ä¸­çš„ src
import Vue from "vue";
import Main from "./main.vue";
import { PopupManager } from "@/utils/popup";
let MessageConstructor = Vue.extend(Main);

let instance; // å½“å‰çš„messageå®ä¾‹
let instances = []; // ä¿å­˜æ‰€æœ‰æœªå…³é—­çš„messageå®ä¾‹
let seed = 1; // æ¯ä¸ªmessageç‹¬ä¸€æ— è€Œçš„id

// 
const Message = function (options) {
  options = options || {};
  // æ”¯æŒthis.$message("è¿™æ˜¯ä¸€æ¡æç¤º")
  if (typeof options === "string") {
    options = {
      message: options,
    };
  }
  let userOnClose = options.onClose;
  let id = "message_" + seed++;

  // messageå…³é—­æ—¶çš„å›è°ƒå‡½æ•°
  options.onClose = function () {
    Message.close(id, userOnClose);
  };
  instance = new MessageConstructor({
    data: options,
  });

  instance.id = id;
  instance.$mount();
  document.body.appendChild(instance.$el);
  let verticalOffset = options.offset || 20;
  instances.forEach((item) => {
    verticalOffset += item.$el.offsetHeight + 16;
  });

  // ç»™å½“å‰messageå®ä¾‹çš„dataå±æ€§èµ‹å€¼
  instance.verticalOffset = verticalOffset;
  instance.visible = true;

  // ä½¿ç”¨PopupManagerå…¨å±€ç®¡ç†messageï¼Œæ¯è§¦å‘ä¸€ä¸ªmessage
  // è¯¥messageçš„z-indexéƒ½ä¼šå¢1
  instance.$el.style.zIndex = PopupManager.nextZIndex();

  instances.push(instance);
  return instance;
};

// ç»™ Message ç»‘å®šå››ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯ successã€warningã€infoã€error
// æ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™å¯ä»¥ this.$message.success('è¿™æ˜¯ä¸€ä¸ªæç¤ºï¼ï¼') è¿™ç§æ–¹å¼ä½¿ç”¨
["success", "warning", "info", "error"].forEach((type) => {
  Message[type] = (options) => {
    if (typeof options === "string") {
      options = {
        message: options,
      };
    }
    options.type = type;
    return Message(options);
  };
});

// closeå‡½æ•°ä¸»è¦åšä¸¤ä»¶äº‹ï¼š
// 1.ä»instancesåˆ é™¤å…³é—­çš„messageå®ä¾‹
// 2.instancesä¸­å‰©ä¸‹çš„messageå®ä¾‹å‘ä¸Šç§»åŠ¨ ï¼ˆè‡ªèº«çš„é«˜åº¦ + 16ï¼‰çš„è·ç¦»

Message.close = function (id, userOnClose) {
  let len = instances.length;
  let index = -1;
  let removedHeight;
  for (let i = 0; i < len; i++) {
    if (id === instances[i].id) {
      removedHeight = instances[i].$el.offsetHeight;
      index = i;
      if (typeof userOnClose === "function") {
        userOnClose(instances[i]);
      }
      instances.splice(i, 1);
      break;
    }
  }
  if (len <= 1 || index === -1 || index > instances.length - 1) return;
  // æ¯ä¸€ä¸ªmessageå®ä¾‹å…³é—­æ—¶ï¼Œåé¢çš„messageéœ€è¦å‘ä¸Šç§»åŠ¨ï¼ˆremovedHeight - 16ï¼‰çš„è·ç¦»
  for (let i = index; i < len - 1; i++) {
    let dom = instances[i].$el;
    dom.style["top"] =
      parseInt(dom.style["top"], 10) - removedHeight - 16 + "px";
  }
};

Message.closeAll = function () {
  for (let i = instances.length - 1; i >= 0; i--) {
    instances[i].close();
  }
};

export default Message;

```
