---
title: è‡ªåŠ¨åŒ–è„šæœ¬å‘½ä»¤
date: 2021-05-24 21:51:14
permalink: /pages/fc5943/
categories:
  - å‰ç«¯ä¹±ç‚–
  - vue
  - vueç»„ä»¶åº“å¼€å‘å®è·µ
tags:
  - 
---
å½“é¡¹ç›®å˜å¾—è¶Šæ¥è¶Šæ¥å¤§ï¼Œæˆ‘ä»¬ä¼šæ¸æ¸å‘ç°ï¼Œæœ‰å¾ˆå¤šå·¥ä½œæ˜¯é‡å¤çš„ï¼Œå¦‚æœæ˜¯äººå·¥æ¯æ¬¡å¼€å‘éƒ½å»åšä¸€éï¼Œæ•ˆç‡å¤ªä½ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦æåˆ° è‡ªåŠ¨åŒ– äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ `MSSUI` æ˜¯å¦‚ä½•åˆ©ç”¨ è‡ªåŠ¨åŒ–è„šæœ¬ æé«˜é¡¹ç›®çš„å¼€å‘æ•ˆç‡çš„ã€‚

### ç®€åŒ–å‘½ä»¤è¾“å…¥
æˆ‘ä»¬ç»å¸¸éœ€è¦åœ¨å‘½ä»¤è¡Œæ‰‹åŠ¨è¾“å…¥å‘½ä»¤ï¼Œä½†æ˜¯æœ‰æ—¶å€™å‘½ä»¤å¤ªé•¿ï¼Œæ‡’å¾—è¾“çš„åŒæ—¶ï¼Œå¯èƒ½è¿˜è®°ä¸ä½å‘½åã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [make](http://c.biancheng.net/makefile/)å·¥å…·å®šä¹‰ å‘½ä»¤çš„åˆ«å ã€‚`make`å…¶å®æ˜¯ç”¨æ¥ ç¼–è¯‘ å¤§å‹çš„C++é¡¹ç›®çš„ï¼Œå¯¹æˆ‘ä»¬å‰ç«¯eræ¥è¯´å°±ç›¸å½“äºæˆ‘ä»¬çš„ [shell](https://www.runoob.com/linux/linux-shell.html) å‘½ä»¤ã€‚

#### makefileæ–‡ä»¶
ä½¿ç”¨ `make` å‘½ä»¤å…¶å®å¾ˆç®€å•ï¼Œåœ¨ä½ é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»º `makefile` æ–‡ä»¶ï¼Œå½“æ‰§è¡Œ `make` å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å»é¡¹ç›®æ ¹ç›®å½•ä¸‹ `makefile` æ–‡ä»¶ä¸­æŸ¥æ‰¾æ‰§è¡Œçš„å‘½ä»¤ã€‚

è„šæœ¬å®šä¹‰å¦‚ä¸‹ï¼š

```sh

default: help

# makeè‡ªåŠ¨åŒ–å‘½ä»¤å®šä¹‰è„šæœ¬
pub:
	npm run pub

install:
	npm install

install-cn:
	npm install --registry=http://registry.npm.taobao.org

dev:
	npm run dev

new:
	node build/bin/new.js $(filter-out $@,$(MAKECMDGOALS))

help:
	@echo "   \033[35mmake\033[0m \033[1må‘½ä»¤ä½¿ç”¨è¯´æ˜\033[0m"
	@echo "   \033[35mmake install\033[0m\t\033[0m\t\033[0m\t\033[0m\t---  å®‰è£…ä¾èµ–"
	@echo "   \033[35mmake new <component-name> [ä¸­æ–‡å]\033[0m\t---  åˆ›å»ºæ–°ç»„ä»¶ package. ä¾‹å¦‚ 'make new button æŒ‰é’®'"
	@echo "   \033[35mmake dev\033[0m\t\033[0m\t\033[0m\t\033[0m\t---  å¼€å‘æ¨¡å¼"
	@echo "   \033[35mmake pub\033[0m\t\033[0m\t\033[0m\t\033[0m\t---  å‘å¸ƒnpm.è‡ªåŠ¨å¢åŠ å°ç‰ˆæœ¬"

```
å®šä¹‰ `make` å‘½ä»¤å¾ˆç®€å•ï¼Œå¦‚ï¼š
```sh
install:
	npm install
```
`install` æ˜¯ `npm install` å‘½ä»¤çš„åˆ«åï¼Œå½“ä½ åœ¨å‘½ä»¤è¡Œè¾“å…¥ `make install` çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯æ‰§è¡Œ `npm install`

`make` å‘½ä»¤åŒæ—¶å¯ä»¥è¾“å…¥å‚æ•°ï¼Œæ¯”å¦‚ï¼š
 ```sh
new:
	node build/bin/new.js $(filter-out $@,$(MAKECMDGOALS))
```
`filter-out` æ˜¯ `make` æä¾›çš„ è¿‡æ»¤å‡½æ•°ï¼Œæ¯”å¦‚ï¼š
```sh
OBJ=$(filter-out 1.o 2.c ,1.o 2.c 3.s)
all:
	@echo $(OBJ)
```

å‘½ä»¤è¡Œæ‰§è¡Œ `make all` ï¼Œè¾“å‡ºä¸º `3.s`, `$@` æŒ‡å‘ å½“å‰æ‰§è¡Œçš„ `make` å‘½ä»¤çš„ åˆ«åã€‚
```sh
all:
	@echo $@
```

å‘½ä»¤è¡Œæ‰§è¡Œ `make all`, è¾“å‡ºä¸º `all`ã€‚

é‚£è¿™é‡Œ `new` å‘½ä»¤ï¼Œå°±æ˜¯è¿‡æ»¤æ‰ `new`, è¿”å›ç´§è·Ÿ `new` åé¢çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯å½“ä½ æ‰§è¡Œ `make new city-list` çš„æ—¶å€™ï¼Œå®é™…ä¸Šè¿”å›çš„å‘½ä»¤è¡Œå‚æ•°æ˜¯ `city-list`ã€‚

`help` æ˜¯ `make` æä¾›çš„é»˜è®¤å‘½ä»¤ ä½†ä½ æ‰§è¡Œ `name` æ—¶ï¼Œé»˜è®¤æ‰§è¡Œçš„å°±æ˜¯ `make help`,æŸ¥çœ‹å½“å‰ `makefile` æ–‡ä»¶ä¸­å®šä¹‰çš„å‘½ä»¤ã€‚å¦‚ä¸‹å›¾ï¼š
::: center
<img src="https://cdn.jsdelivr.net/gh/MssText/learn@master/images/image-20210526133140812.5tvctaslvno0.png">
:::

ç®€åŒ–è¿‡åï¼Œå¦‚æ‰§è¡Œ `node build/bin/new.js city-list` å‘½ä»¤ï¼Œç›´æ¥æ‰§è¡Œ `make new city-list`å³å¯ï¼Œéå¸¸æ–¹ä¾¿ã€‚

### æ–°å¢ç»„ä»¶å‘½ä»¤
å½“æˆ‘ä»¬ç»„ä»¶åº“éœ€è¦æ–°å¢ç»„ä»¶çš„æ—¶å€™ï¼Œæ¯”å¦‚æ–°å¢ `city` ç»„ä»¶ï¼Œæˆ‘ä»¬ä¼šæœ‰è¿™æ ·çš„æ­¥éª¤ï¼š

1. åœ¨`src/packages/`ç›®å½•ä¸‹æ–°å¢ `city` ç›®å½•ï¼Œ`city` ç›®å½•ä¸‹æ–°å¢ `main.vue` å’Œ `index.js` æ–‡ä»¶ã€‚

2. åœ¨ `main.vue` æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š
```vue
<template>
  <div class="ml-city"></div>
</template>

<script>
export default {
  name: "MlCity",
};
</script>
```

3. åœ¨ `index.js` æ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š
```js
import MlCity from "./main";

MlCity.install = function (Vue) {
  Vue.component(MlCity.name, MlCity);
};

export default MlCity;

```

4. åœ¨ `src/theme`ç›®å½•ä¸‹ï¼Œæ–°å»º `city.scss`æ–‡ä»¶ï¼Œå¹¶å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

```scss
@import "mixins/mixins";
@import "common/var";

@include b(city) {}

```

5. åœ¨ `src/theme/index.scss`ç›®å½•ä¸‹ï¼Œå¼•å…¥ï¼š

```scss {2}
// ...
@import "./city.scss";
```
6. åœ¨ `src`ç›®å½•å…ˆçš„ `components.js` æ–‡ä»¶ä¸­å¼•å…¥ï¼š

```js {2,6}
// ....
import MlCity from "./packages/city";

export default [
  // ...
  MlCity,
];

```
::: warning
å…¶å®ï¼Œè¿˜éœ€è¦å¢åŠ  city ç»„ä»¶çš„ æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶ å’Œ ç±»å‹å£°æ˜æ–‡ä»¶ï¼Œè¿™é‡Œæš‚ä¸è€ƒè™‘ã€‚
:::

æ¯æ¬¡æ–°å¢ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½å¾—æ‰‹åŠ¨å»åšè¿™å…­ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½åšåˆ°æ‰§è¡Œä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥äº†å‘¢ï¼Ÿ
æ¯”å¦‚ï¼Œæ–°å¢ä¸€ä¸ªç»„ä»¶ï¼Œåªéœ€è¦æ‰§è¡Œ `make new newComponentName` ï¼Œå°±è‡ªåŠ¨èµ°å®Œè¿™å…­ä¸ªæ­¥éª¤ã€‚æˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥çš„å®ç°ã€‚
æˆ‘ä»¬åœ¨ `build/bin` ç›®å½•ä¸‹æ–°å¢ `new.js` æ–‡ä»¶ç”¨äºå®šä¹‰è„šæœ¬æ–‡ä»¶ã€‚

#### è‡ªåŠ¨åˆ›å»ºæ–°ç»„ä»¶æ–‡ä»¶ç›®å½•
åˆ›å»ºæ–‡ä»¶ç›®å½•æ€è·¯æ˜¯ï¼š
> æ ¹æ® `src/packages`ç›®å½•è·å–ç»„ä»¶éœ€è¦åˆ›å»ºçš„æ–‡ä»¶çš„ç›®å½•ï¼Œ ç„¶åä½¿ç”¨ `file-save`è¿™ä¸ªåº“è¿›è¡Œæ–‡ä»¶å†…å®¹çš„ è¯»å†™ã€‚
é¦–å…ˆå¼•å…¥éœ€è¦çš„å¤–éƒ¨åº“å’Œnodeæ¨¡å—

```js
const path = require("path");
const fs = require("fs");
const fileSave = require("file-save");
const uppercamelcase = require("uppercamelcase");
const chalk = require("chalk");
```

1. è·å–ç»„ä»¶çš„åç§°

```js
const componentname = process.argv[2];
const ComponentName = uppercamelcase(componentname);
```
æ¯”å¦‚æ‰§è¡Œ `make new city-list`ï¼Œ`componentName` å°±æ˜¯ `city-list`,ç„¶åä½¿ç”¨ `uppercamelcase` åº“å°† è¿å­—ç¬¦ çš„ç»„ä»¶åå­—è½¬æ¢æˆé¦–å­—æ¯å¤§å†™ï¼Œå³ `CityList`ã€‚

2. æ‹¼æ¥ç»„ä»¶çš„ç»å¯¹è·¯å¾„

```js
const PackagePath = path.resolve(
  __dirname,
  "../../src/packages",
  componentname
);
```

3. æ‹¼æ¥ç»„ä»¶ä¸­ `main.vue` å’Œ `index.js` ä¸­éœ€è¦å†™å…¥çš„å†…å®¹
```js
const Files = [
  {
    filename: "index.js",
    content: `import Ml${ComponentName} from "./main";

Ml${ComponentName}.install = function (Vue) {
  Vue.component(Ml${ComponentName}.name, Ml${ComponentName});
};

export default Ml${ComponentName};`,
  },
  {
    filename: "main.vue",
    content: `<template>
  <div class="ml-${componentname}"></div>
</template>

<script>
export default {
  name: "Ml${ComponentName}",
};
</script>`,
  },
];
```
4. åˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥å†…å®¹

```js
Files.forEach((file) => {
  fileSave(path.join(PackagePath, file.filename))
    .write(file.content, "utf8")
    .end("\n");
});

console.log(chalk.blue("DONEï¼ğŸ˜„ğŸ˜„ğŸ˜„"));

```

#### è‡ªåŠ¨åˆ›å»ºæ ·å¼æ–‡ä»¶å¹¶å¼•å…¥

1. æ‹¼æ¥æ ·å¼æ–‡ä»¶å†…å®¹

```js
const newComponentText = `
@import "mixins/mixins";
@import "common/var";

@include b(${componentname}) {}`;
```

2. æ‹¼æ¥è·¯å¾„å¹¶åˆ›å»ºæ ·å¼æ–‡ä»¶

```js
fileSave(path.join(ThemePath, `${componentname}.scss`))
  .write(newComponentText, "utf8")
  .end("\n");
```
3. `src/theme/index.scsss` ä¸­è‡ªåŠ¨å¼•å…¥

```js
const sassPath = path.join(__dirname, "../../src/theme/index.scss");
const sassImportText = `${fs.readFileSync(sassPath)}
@import "./${componentname}.scss";`;
fileSave(sassPath).write(sassImportText, "utf8").end("\n");
```

#### **src/components.js** ä¸­è‡ªåŠ¨å¼•å…¥æ–°ç»„ä»¶
è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ`components` æ–‡ä»¶ä¸­ä¸èƒ½å®Œå…¨è¦†ç›–åŸæ¥çš„å†…å®¹ï¼Œè€Œæ˜¯éœ€è¦åœ¨åé¢æ–°å¢å†…å®¹,æ‰€ä»¥æ€è·¯æ˜¯ï¼š
ä»¥ `export` ä¸ºå¼€å§‹ç´¢å¼•ï¼Œ `]` ä¸ºç»“æŸç´¢å¼•è¿›è¡ŒåŸå§‹å†…å®¹çš„åˆ‡å‰²ï¼Œç„¶åå°†æ–°ç»„ä»¶éœ€è¦æ·»åŠ çš„å†…å®¹æ‹¼æ¥ä¸Šå»ï¼Œæœ€åå†™å…¥ `components.js` æ–‡ä»¶

```js
const componensPath = path.join(__dirname, "../../src/components.js");

let componensText = `${fs.readFileSync(componensPath)}`;

const importIndex = componensText.indexOf("export") - 1;
const endIndex = componensText.indexOf("]");

const importString = `import Ml${ComponentName} from "./packages/${componentname}";`;

// æ‹¼æ¥ä¸Šæ–°ç»„å»ºçš„å¯¼å…¥å’Œå¯¼å‡º
componensText =
  componensText.slice(0, importIndex) +
  importString +
  "\n" +
  componensText.slice(importIndex, endIndex) +
  `Ml${ComponentName}];`;

fileSave(componensPath).write(componensText, "utf8").end("\n");
```
è¿™æ ·å°±å®ç°äº†å¢åŠ æ–°ç»„ä»¶ ä¸€è¡Œ `make new componentName`å°±æå®šäº†ã€‚

### å‘å¸ƒè‡ªåŠ¨å¢åŠ å°ç‰ˆæœ¬
ç»„ä»¶åº“å‘å¸ƒåˆ°npmçš„æ—¶å€™ï¼Œè€æ˜¯å¿˜è®°å¢åŠ å°ç‰ˆæœ¬å·ï¼Œäºæ˜¯ä¹ŸåŠ äº†ä¸€ä¸ªè‡ªåŠ¨å¢åŠ å°ç‰ˆæœ¬å·çš„è„šæœ¬å‘½ä»¤ï¼š
```sh
#!/usr/bin/env sh
set -e

npm version patch
npm publish
```
