---
title: ç»„ä»¶é¢„è§ˆå’Œåœ¨çº¿è¿è¡Œ
date: 2021-05-24 22:05:55
permalink: /pages/493813/
categories:
  - å‰ç«¯ä¹±ç‚–
  - vue
  - vueç»„ä»¶åº“å¼€å‘å®è·µ
tags:
  - vueç»„ä»¶
---

### å‰è¨€

å‰é¢æˆ‘ä»¬å·²ç»é…ç½®äº†ç»„ä»¶åº“çš„åŸºæœ¬é…ç½®ï¼Œä½†æ˜¯å¯ä»¥çœ‹ä¸‹ `ElementUI`çš„ç»„ä»¶å±•ç¤ºçš„å®˜ç½‘æ•ˆæœ:

::: center
<img style="height: 400px" src="https://cdn.jsdelivr.net/gh/MssText/learn@master/images/image-20210531165306095.3q75hfn1yxa0.png">
:::
æˆ‘ä»¬å¯ä»¥ä»å›¾ä¸­å‘ç°æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š

- æ˜¾ç¤ºå’Œéšè—ä»£ç 
- èƒ½é¢„è§ˆç»„ä»¶çš„æ•ˆæœ
- å±•ç¤ºç»„ä»¶çš„æºä»£ç 
- æ”¯æŒcodepenåœ¨çº¿è¿è¡Œ

åŒæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å¢åŠ `ä¸€é”®å¤åˆ¶`çš„åŠŸèƒ½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä¸€ä¸€çœ‹ä¸‹è¿™ä¸ªåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ã€‚

### æ˜¾ç¤ºå’Œéšè—ä»£ç æ•ˆæœ

```vue
<template>
 <div>
    <div class="meta" ref="meta">
      <div class="description" v-if="$slots.default">
        <slot></slot>
      </div>
    </div>
    <div
      class="demo-block-control"
      ref="control"
      :class="{ 'is-fixed': fixedControl }"
      :style="{width:width+'px'}"
      @click="isExpanded = !isExpanded">
      <transition name="arrow-slide">
        <i :class="[iconClass, { 'hovering': hovering }]"></i>
      </transition>
      <transition name="text-slide">
        <span v-show="hovering">{{ controlText }}</span>
      </transition>
      <transition name="text-slide">
        <span
          class="control-button"
          v-show="hovering || isExpanded"
          @click.stop="goCodepen"
        >{{ langConfig['button-text'] }}</span>
      </transition>
      </div>
 </div>
</template>
<script>

export default {
  name: 'DemoBlock',
  data () {
    return {
      isExpanded: false, // æ˜¯å¦å±•å¼€ä»£ç 
      fixedControl: false, // æ˜¯å¦å›ºå®šæ“ä½œåŒºåŸŸ(å¤åˆ¶ã€å±•å¼€ä»£ç ã€codepenåœ¨çº¿è¿è¡Œ)
      scrollParent: null, // æ»šåŠ¨çš„çˆ¶å®¹å™¨
    }
  },

  methods: {
    // this.$refs.metaæ‹¿åˆ°çš„æ˜¯æºä»£ç çš„å±•ç¤ºåŒºåŸŸ
    // bottom > document.documentElement.clientHeight => åº•éƒ¨çš„æ“ä½œåŒºåŸŸæ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨
    // top + 44 <= document.documentElement.clientHeight => åº•éƒ¨çš„æ“ä½œåŒºåŸŸæ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ 44pxå¤„
    // æ»¡è¶³ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶ï¼Œåˆ™fixedæ“ä½œåŒºåŸŸï¼Œå¦åˆ™ä¸åšå¤„ç†ï¼Œä¸»è¦æ˜¯ç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–ã€‚
    scrollHandler () {
      if (!this.$refs.meta) {
        return
      }
      const { top, bottom, left } = this.$refs.meta.getBoundingClientRect()
      this.fixedControl = bottom > document.documentElement.clientHeight &&
        top + 44 <= document.documentElement.clientHeight
      this.$refs.control.style.left = this.fixedControl ? `${left}px` : '0'
    },

    // ç§»é™¤æ»šåŠ¨äº‹ä»¶
    removeScrollHandler () {
      this.scrollParent && this.scrollParent.removeEventListener('scroll', this.scrollHandler)
    },
  },

  computed: {

    // ä¸­é—´ä¸‰è§’å½¢çš„æ“ä½œçš„æ–‡å­—
    langConfig () {
      return {
        'hide-text': 'éšè—ä»£ç ',
        'show-text': 'æ˜¾ç¤ºä»£ç ',
        'button-text': 'åœ¨çº¿è¿è¡Œ',
        'tooltip-text': 'å‰å¾€ codepen.io è¿è¡Œæ­¤ç¤ºä¾‹'
      }
    },

    // ä¸‰è§’å½¢çš„æ–¹å‘
    iconClass () {
      return this.isExpanded ? 'ml-icon-caret-top' : 'ml-icon-caret-bottom'
    },

    // åŠ¨æ€æ¸²æŸ“æ“ä½œçš„æç¤ºæ–‡å­—
    controlText () {
      return this.isExpanded ? this.langConfig['hide-text'] : this.langConfig['show-text']
    },

    // è·å–ä»£ç åŒºåŸŸçš„å®¹å™¨
    codeArea () {
      return this.$el.getElementsByClassName('meta')[0]
    },

    // ä»£ç å—é«˜åº¦ + 20
    codeAreaHeight () {
      if (this.$el.getElementsByClassName('description').length > 0) {
        return this.$el.getElementsByClassName('description')[0].clientHeight + 20
      }
    }
  },

  watch: {
    // å¦‚æœisExpandedä¸ºtrueï¼Œè¡¨ç¤ºæ­¤æ—¶å±•å¼€äº†ä»£ç 
    // é‡ç½®ä»£ç åŒºåŸŸçš„é«˜åº¦ this.codeAreaHeight
    isExpanded (val) {
      this.codeArea.style.height = val ? `${this.codeAreaHeight + 1}px` : '0'
      if (!val) {
        this.fixedControl = false
        this.$refs.control.style.left = '0'
        this.removeScrollHandler()
        return
      }

      // ç›‘å¬ä»£ç åŒºåŸŸçš„æ»šåŠ¨äº‹ä»¶
      setTimeout(() => {
        window.addEventListener('scroll', this.scrollHandler)
        this.scrollHandler()
      }, 200)
    }
  },

  // ç§»é™¤æ»šåŠ¨äº‹ä»¶
  beforeDestroy () {
    this.removeScrollHandler()
  }
}
</script>
```
ä»£ç ä¸­æ³¨é‡Šå·²ç»æ³¨é‡Šå¾—å¾ˆæ˜ç™½äº†ã€‚ä¸»è¦æ€è·¯å°±æ˜¯ï¼š
> åˆ©ç”¨ `isExpanded` å±æ€§ï¼Œå¦‚æœ `isExpanded` ä¸ºtrueï¼Œåˆ™è¡¨ç¤ºå±•å¼€ä»£ç ï¼Œå°†ä»£ç åŒºåŸŸçš„é«˜åº¦è®¾ç½®ä¸ºçœŸå®çš„é«˜åº¦ã€‚å¦åˆ™ï¼Œå°†ä»£ç å—çš„é«˜åº¦è®¾ç½®ä¸º0ã€‚åŒæ—¶ï¼Œä¸‰è§’å½¢çš„å‘ä¸Šå’Œå‘ä¸‹çš„æ–¹å‘ä¹Ÿæ˜¯ç”± `isExpanded` å±æ€§æ§åˆ¶ã€‚é¡µé¢æ»šåŠ¨æ—¶åšäº†ç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–ï¼Œä¼šåœ¨æ»¡è¶³å‰ææ¡ä»¶çš„åŸºç¡€ä¸Šï¼Œå›ºå®šæ“ä½œåŒºåŸŸã€‚

### é¢„è§ˆç»„ä»¶åŠŸèƒ½

è¿™ä¸ªåŠŸèƒ½å…¶å®å¾ˆç®€å•ï¼Œå› ä¸º vuepress é»˜è®¤å°±æ˜¯æ”¯æŒå±•ç¤º vueç»„ä»¶çš„ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ `æ’æ§½`ï¼Œå°†æ¸²æŸ“çš„ç»„ä»¶æ”¾ç½®çš„åˆé€‚çš„ä½ç½®å°±è¡Œäº†ã€‚

```vue {4,5,6}

<template>
 <div>
    <div class="source">
      <slot name="source"></slot>
    </div>
    <div class="meta" ref="meta">
      <div class="description" v-if="$slots.default">
        <slot></slot>
      </div>
    </div>
    <div
      class="demo-block-control"
      ref="control"
      :class="{ 'is-fixed': fixedControl }"
      :style="{width:width+'px'}"
      @click="isExpanded = !isExpanded">
      <transition name="arrow-slide">
        <i :class="[iconClass, { 'hovering': hovering }]"></i>
      </transition>
      <transition name="text-slide">
        <span v-show="hovering">{{ controlText }}</span>
      </transition>
      <transition name="text-slide">
        <span
          class="control-button"
          v-show="hovering || isExpanded"
          @click.stop="goCodepen"
        >{{ langConfig['button-text'] }}</span>
      </transition>
      </div>
 </div>
</template>

```

å¦‚ä¸Šï¼Œå¢åŠ é«˜äº®çš„ä»£ç ã€‚å‰é¢æˆ‘ä»¬æåˆ°ï¼Œç»„ä»¶å®šä¹‰åœ¨`.vuepress/components`ä¸‹ï¼Œç»„ä»¶çš„æ–‡æ¡£è¯´æ˜æ”¾ç½®åœ¨ `.vuepress/components`ä¸‹ï¼Œç°åœ¨æˆ‘ä»¬å›åˆ°ç»„ä»¶çš„æ–‡æ¡£è¯´æ˜ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿé¢„è§ˆç»„ä»¶æ•ˆæœäº†ï¼Œæ‰“å¼€`.vuepress/component/Button.md`:

```js

<demo-block>

<button-demo-base slot="source"></button-demo-base>

</demo-block>

```

è¿™æ ·ç»„ä»¶å°±æ¸²æŸ“å‡ºæ¥äº†ã€‚

### å±•ç¤ºç»„ä»¶çš„æºä»£ç 

vuepress ä¹Ÿæä¾›äº† `>>>`ã€‚ç”¨äºå‘Šè¯‰ vuepressï¼Œä¸éœ€è¦ç¼–è¯‘ `>>>` åé¢çš„ç»„ä»¶ï¼Œè€Œæ˜¯ç›´æ¥å±•ç¤ºç»„ä»¶çš„æºä»£ç ã€‚

ç›¸å½“äºè¿™æ ·ä½¿ç”¨ï¼Œå†æ¬¡ä»¥ `Button.md` ä¸ºä¾‹ï¼š

```js

<demo-block>

<button-demo-base slot="source"></button-demo-base>
<<< @/src/docs/.vuepress/components/button/demo-base.vue

</demo-block>

```

å…¶å®ä¹Ÿå°±æ˜¯å±•ç¤ºåœ¨ `ref="meta"` çš„åŒºåŸŸï¼š

```vue
<template>
 <div>
    <div class="source">
      <slot name="source"></slot>
    </div>
    <div class="meta" ref="meta">
      <div class="description" v-if="$slots.default">
        <slot></slot>
      </div>
    </div>
    <div
      class="demo-block-control"
      ref="control"
      :class="{ 'is-fixed': fixedControl }"
      :style="{width:width+'px'}"
      @click="isExpanded = !isExpanded">
      <transition name="arrow-slide">
        <i :class="[iconClass, { 'hovering': hovering }]"></i>
      </transition>
      <transition name="text-slide">
        <span v-show="hovering">{{ controlText }}</span>
      </transition>
      <transition name="text-slide">
        <span
          class="control-button"
          v-show="hovering || isExpanded"
          @click.stop="goCodepen"
        >{{ langConfig['button-text'] }}</span>
      </transition>
      </div>
 </div>
</template>

```

### ä¸€é”®å¤åˆ¶åŠŸèƒ½

```vue {17,18,19,20,21,22,23}
<template>
 <div>
    <div class="source">
      <slot name="source"></slot>
    </div>
    <div class="meta" ref="meta">
      <div class="description" v-if="$slots.default">
        <slot></slot>
      </div>
    </div>
    <div
      class="demo-block-control"
      ref="control"
      :class="{ 'is-fixed': fixedControl }"
      :style="{width:width+'px'}"
      @click="isExpanded = !isExpanded">
      <transition name="text-slide">
        <span
          class="copy-code-button"
          v-show="isExpanded || isExpanded"
          @click.stop="copyCode"
        >å¤åˆ¶ä»£ç </span>
      </transition>
      <transition name="arrow-slide">
        <i :class="[iconClass, { 'hovering': hovering }]"></i>
      </transition>
      <transition name="text-slide">
        <span v-show="hovering">{{ controlText }}</span>
      </transition>
      <transition name="text-slide">
        <span
          class="control-button"
          v-show="hovering || isExpanded"
          @click.stop="goCodepen"
        >{{ langConfig['button-text'] }}</span>
      </transition>
      </div>
 </div>
</template>

```
å¢åŠ å¦‚å›¾é«˜äº®çš„ä»£ç ã€‚ç„¶åå¯ä»¥çœ‹åˆ°ç‚¹å‡»å¤åˆ¶ä»£ç æ—¶ï¼Œè§¦å‘äº† `copyCode` å‡½æ•°ï¼Œä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š

```vue
  <script>
    // å¤åˆ¶code
    copyCode () {
      if (this.code) {
        this.copyToClipboard(this.code)
      }
    },
    copyToClipboard (textToCopy) {
      if (!textToCopy || textToCopy === '-') {
        return
      }
      const textArea = document.createElement('textarea')
      document.body.appendChild(textArea)
      textArea.value = textToCopy
      textArea.select()
      document.execCommand('Copy')
      textArea.remove()
      this.$message.success('ä»£ç å·²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿')
    }
  </script>
```

å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®å°±æ˜¯è§¦å‘äº† `textarea` çš„å¤åˆ¶äº‹ä»¶ï¼Œå°† `code` å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œä½†æ˜¯ `code` å¦‚ä½•è·å–å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ç»„ä»¶çš„æºä»£ç æ˜¯æ¸²æŸ“åˆ° `ref="meta"`åŒºåŸŸå†…ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯åˆ©ç”¨ `this.$slots.default`, è¯¥å±æ€§æ˜¯ Vue æä¾›ç”¨æ¥è®¿é—®é»˜è®¤æ’æ§½åˆ†å‘çš„å†…å®¹ï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥æ‹¿åˆ°ç»„ä»¶çš„æºä»£ç ã€‚å¦‚ä¸‹ï¼š

```js
  mounted () {

    // stripTemplate(code) è·å– .vue æ–‡ä»¶ä¸­çš„template
    // stripScript(code) è·å– .vueæ–‡ä»¶ä¸­çš„script
    // stripStyle(code) è·å– .vueæ–‡ä»¶ä¸­çš„style
    this.$nextTick(() => {
      this.width = this.$refs.block.clientWidth
      
      // this.$slots.default æ‹¿åˆ°é»˜è®¤æ’æ§½ä¸­æ¸²æŸ“å†…å®¹çš„VNodeï¼Œ
      // VNode ä¸­ä¿å­˜äº†æ’æ§½ä¸­æ¸²æŸ“å†…å®¹çš„å­—ç¬¦ä¸²
      // æ€è·¯æ˜¯ï¼šæ‹¿åˆ°æ¸²æŸ“å­—ç¬¦ä¸²åï¼Œä½¿ç”¨stripTemplateã€stripScriptã€stripScriptä¸‰ä¸ªå‡½æ•°è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…
      const highlight2 = this.$slots.default
      if (highlight2 && highlight2[0]) {
        let code = ''
        let cur = highlight2[2] || {}
        if (cur.elm && cur.elm.children[0]) {
          code = cur.elm.children[0].innerText
          this.code = code
        }

        if (code) {
          this.codepen.html = stripTemplate(code)
          this.codepen.script = stripScript(code)
          this.codepen.style = stripStyle(code)
        }
      }
    })
  },

```

### æ¥å…¥codepen

[codepen](https://codepen.io/pen/) æ˜¯ä¸€æ¬¾å‰ç«¯ä»£ç åœ¨çº¿çš„ç¼–è¾‘å™¨ï¼Œä½ å¯ä»¥å°†ä»£ç ä¿å­˜åˆ°codepenä¸Šï¼Œcodepenä¼šæä¾›ä¸€ä¸ªåœ¨çº¿é“¾æ¥ï¼Œç‚¹å‡»æ‰“å¼€å°±èƒ½é¢„è§ˆä»£ç ç»“æœã€‚æäº¤ä»£ç ç»™codepenæœ‰å¾ˆå¤šæ–¹å¼ï¼Œæˆ‘ä»¬è¿™é‡Œé‡‡ç”¨codepenæä¾›çš„æ¥å£è¿›è¡Œç»„ä»¶ä»£ç çš„æäº¤ã€‚

```js
import { stripScript, stripStyle, stripTemplate } from '@/utils'

export default {
  methods: {
    goCodepen () {

      // è·å–ç»„ä»¶çš„scriptã€htmlã€style
      // å¼•å…¥vueå’Œmssuiçš„CDN
      const { script, html, style } = this.codepen
      const resourcesTpl = `
<script src="https://unpkg.com/vue/dist/vue.js"><\/script>
<!-- å¼•å…¥æ ·å¼ -->
<link rel="stylesheet" href="https://unpkg.com/mssui@0.1.13/lib/theme-chalk/index.css">
<script src="https://unpkg.com/mssui@0.1.13/lib/index.js"></script>
<div id="app">
 ${html}
</div>
`     
      // ç»„ä»¶æŒ‚è½½
      let jsTpl = (script || '').replace(/export default/, 'var Main =').trim()
      let cssTpl=`${(style||'')}`
      jsTpl = jsTpl
        ? jsTpl + '\nvar Ctor = Vue.extend(Main)\nnew Ctor().$mount(\'#app\')'
        : 'new Vue().$mount(\'#app\')'

      // å®šä¹‰å¥½https://blog.codepen.io/documentation/prefill/æ¥å£éœ€è¦çš„æ•°æ®ç»“æ„
      // ä½¿ç”¨formè¡¨å•å‘èµ·POSTè¯·æ±‚ å‘codepenæäº¤ä»£ç 
      const data = {
        js: jsTpl,
        css: cssTpl,
        html: resourcesTpl
      }
      // seeï¼š https://blog.codepen.io/documentation/prefill/
      const form = document.createElement('form')
      form.method = 'POST'
      form.action = 'https://codepen.io/pen/define/'
      form.target = '_blank'
      form.style.display = 'none'

      const input = document.createElement('input')
      input.setAttribute('name', 'data')
      input.setAttribute('type', 'hidden')
      input.setAttribute('value', JSON.stringify(data))
      form.appendChild(input)
      document.body.appendChild(form)
      form.submit()

      document.body.removeChild(form)
    }
  }
}
```

è¿™æ ·æˆ‘ä»¬å°±å®ç°äº† `demo-block` æ‰€æœ‰çš„åŠŸèƒ½ï¼Œæœ€åå®ç°çš„æ•ˆæœå¦‚ä¸‹ï¼š

::: demo

```vue
<template>
<div>
  <ml-button @click="handleClick('text')">é»˜è®¤æŒ‰é’®</ml-button>
  <ml-button type="primary" @click="handleClick('primary')">ä¸»è¦æŒ‰é’®</ml-button>
  <ml-button type="success" @click="handleClick('success')">æˆåŠŸæŒ‰é’®</ml-button>
</div>
</template>

<script>
  export default {
    name: 'button-demo-base',
    methods: {
      handleClick(type) {
        this.$message.success(`ç‚¹å‡»äº†æŒ‰é’®ï¼ğŸ˜‚ğŸ˜„`)
      }
    }
  }
</script>
```
:::

æœ€åä½ å°±èƒ½å‘æŒ¥ä½ çš„æƒ³è±¡åŠ›å’Œåˆ›é€ åŠ›ï¼Œä¹¦å†™ç»„ä»¶çš„å®˜æ–¹æ–‡æ¡£äº†ã€‚
